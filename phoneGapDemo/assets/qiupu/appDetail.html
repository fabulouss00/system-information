<!DOCTYPE HTML>
<html>
    <head>
	<meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no">  	
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
	<title>App Detail</title>
	<link rel="stylesheet" href="style/bootstrap.css">
	<link rel="stylesheet" href="style/bootstrap-responsive.css">
	<link rel="stylesheet" href="style/qiupu-responsive.css">
	<!--[if lte IE 8]>
		<link href="style/IE.css" rel="stylesheet" type="text/css" />
	<![endif]-->
	<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="js/jquery.cookie.js"></script>
	<script type="text/javascript" src="js/bootstrap-carousel.js"></script>
	<script type="text/javascript" src="js/md5.js"></script>
	<script type="text/javascript" src="js/json2.js"></script>
	<script type="text/javascript" src="js/qiupu.js"></script>
	<script type="text/javascript" src="js/qiupu.timeline.js"></script>
	<script type="text/javascript" src="js/qiupu.appdetail.js"></script>
	<script type="text/javascript">
		var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
		document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F9aacf3c05656367a5c404f7ac61671ee' type='text/javascript'%3E%3C/script%3E"));//for baidu statistic

/////////////////////////////////////////////////////////////Google Analytics/////////////////////////////////////////////////////////////
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-32237702-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
/////////////////////////////////////////////////////////////Google Analytics/////////////////////////////////////////////////////////////

		locale = $.cookie('locale');//read locale at first

		var appId = $.cookie('app_package') +'-9999-x';
		var ticket = $.cookie('ticket');
		$(document).ready(function(){
			setLocaleString(locale);
			if((ticket == null) || (ticket == '')) $('#commentsDiv').css('display', 'none');
		});

		function appendScreenshots(items) {
			ret = '';
			$.each(items, function(i, item) {
				if (i === 0)
					ret += '<div class=\'active item\'><div style=text-align:center><img src=' + item + '></div></div>';
				else
					ret += '<div class=\'item\'><div style=text-align:center><img src=' + item + '></div></div>';
			});
			$('#carouselInner').html(ret);
		}

		function calculateSize(size) {
			sizeM = 1024*1024;
			if (size > 10 * sizeM)		ssize = (size / sizeM).toFixed(1) + "M";
			else if (size > 10 * 1024)	ssize = (size / 1024).toFixed(0) + "K";
			else if (size > 0)		ssize = size + "B";
			else				ssize = "";
			return ssize;
		}

		function getComments(id, packageName) {
			if((ticket == null) || (ticket == '')) {
				invokeApi('comment/for', {'object':4, 'target':packageName, 'count':99999999}, function(ret) {
					$(id).append(comment(ret));
				});
			}
			else//if logged in, send ticket
				invokeApi('comment/for', prepareData({'object':4, 'target':packageName, 'count':99999999}), function(ret) {
					$(id).append(comment(ret));
				});
		}

		function appendDetail(id, item) {
			tmp = '<img src=' + item.icon_url + ' onload=resizeimg(this,60,60)>'
			$('#appIcon').html(tmp);

			tmp = item.app_name + ' v' + item.version_name + '<br>';
			tmp += resRating[locale] + item.rating.toFixed(1) + '<br>';
			tmp += resDownloads[locale] + item.download_count + '<br>';
			tmp += resSize[locale] + calculateSize(item.file_size);
			$('#appMisc').html(tmp);
			
			$('#appDownload').html('<div class=\'btn btn-large btn-primary appDownloadBtn\' onclick=javascript:window.location=\'http://api.borqs.com/search?q=' + $.cookie('app_package') + '\'>' + resDownload[locale] + '</div>');

			$('#appDesc').html(item.description);

			appendScreenshots(item.screenshots_urls);

			$('#appName').html(item.app_name);

			appId = item.apk_id;
			getComments('#appComments', item.package);
		}

		invokeApi("qiupu/app/get", {'apps':appId}, function(ret) {
			appendDetail('#appdetail', ret[0]);
		});

		function addComments() {
			invokeApi("comment/create", prepareData({ 'object':4, 'target':appId, 'message':$('#comments').val() }), function(ret) {
				$('#appComments').html('');;
				getComments('#appComments', $.cookie('app_package'));
				$('#comments').attr('value', '');
			});
		}
	</script>
</head>
	
	
<body>
    <!-- HEADER START -->
    <div class='navbar navbar-fixed-top' >
	<div class='navbar-inner'>
		<div class="container-fluid" >
			<a class="brand" id='appName'></a>
			<a class='navbar-text pull-right' href="appstore.html" id='mainPage'></a>
		</div>
	</div>
    </div>
    <!-- HEADER END -->

	<!-- content -->
	<div class="container row" style='margin:auto'>
		<table class='span8 spanpost' style='margin:auto; float:none'>
			<tr>
				<td width=50px><div class=appDescription id=appIcon></div></td>
				<td><div class=appDescription id=appMisc></div></td>
				<td id=appDownload></td>
			</tr>

			<tr><td colspan=3><div class=appDescription id=appDesc></div></td></tr>

			<tr><td colspan=3><div id=myCarousel class='appDescription carousel span4' style='margin-left:auto; margin-right:auto'>
				<div class=carousel-inner id=carouselInner></div>
				<a class='carousel-control left' href='#myCarousel' data-slide='prev'>&lsaquo;</a>
				<a class='carousel-control right' href='#myCarousel' data-slide='next'>&rsaquo;</a>
			</div></td></tr>

			<tr><td colspan=3><div id='commentsDiv' style='margin: 10px'>
				<textarea class='span7 row-fluid' id="comments"></textarea>
				<button class="btn btn-warning btn-small pull-right" id='btnComments' onclick="addComments()"></button>
			</div></td></tr>

			<tr><td colspan=3><div id=appComments></div></td></tr>

		</table>
	</div>
 </body>		   
</html>
